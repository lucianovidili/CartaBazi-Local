let btnCalcular=document.getElementById('btnCalcular');btnCalcular.addEventListener('click',btnCalcularHandler);let btnR=document.getElementById('btnR');btnR.addEventListener('click',btnRHandler);const requestConstURL='http://localhost:8080/cartabazi/';const imgPath='images/animales/';let ihoraNac=document.getElementById('horaNac');let iminutosNac=document.getElementById('minutosNac');let fechaNac;const exampleDate='dd/mm/aaaa';const exampleDateColor='grey';const inputColor='black';let despListDia=document.getElementById('despDiaNac');let despListMes=document.getElementById('despMesNac');let despListAno=document.getElementById('despAnoNac');let despListHour=document.getElementById('despHoraNac');let despListMinutes=document.getElementById('despMinutosNac');const today=new Date();const actualYear=today.getFullYear();setAnimalesClickHandlers();setPilaresClickHandlers();populateDespLists();despListDia.value=today.getDate();despListMes.value=convertMonth(today.getMonth()+1);if(actualYear>2043){despListAno.value=2043}else{despListAno.value=actualYear}document.getElementById('aTitle').addEventListener('click',aTitleClickHandler);function aTitleClickHandler(){if(sessionStorage.getItem('pressedPilar')){sessionStorage.removeItem('pressedPilar')}}handleBackgroundImage();function handleBackgroundImage(){let imgDeFondo=document.getElementById('imgDeFondo');const minWidth=1300;if(screen.width<=minWidth){imgDeFondo.setAttribute('src','images/papel-tapiz/hojas-verdes-celulares.jpg')}}function setAnimalesClickHandlers(){let pEnvoltura=document.getElementById('pEnvoltura');let pTronco=document.getElementById('pTronco');let pDefensa=document.getElementById('pDefensa');let pPoder=document.getElementById('pPoder');pEnvoltura.addEventListener('click',aAnimalsExplanationHandler);pTronco.addEventListener('click',aAnimalsExplanationHandler);pDefensa.addEventListener('click',aAnimalsExplanationHandler);pPoder.addEventListener('click',aAnimalsExplanationHandler)}function setPilaresClickHandlers(){let aEnvoltura=document.getElementById('aEnvoltura');let aTronco=document.getElementById('aTronco');let aDefensa=document.getElementById('aDefensa');let aPoder=document.getElementById('aPoder');aEnvoltura.addEventListener('click',aPilaresExplanationHandler);aTronco.addEventListener('click',aPilaresExplanationHandler);aDefensa.addEventListener('click',aPilaresExplanationHandler);aPoder.addEventListener('click',aPilaresExplanationHandler)}function aAnimalsExplanationHandler(e){let pilarId=e.target.id;let para=removeDragonAccent(document.getElementById(pilarId).textContent);sessionStorage.setItem('pressedAnimal',para);}function aPilaresExplanationHandler(e){let pilarId=e.target.id;let para=document.getElementById(pilarId).textContent;sessionStorage.setItem('pressedPilar',para);}let yearOutGolangApi;setImgAnimalsClickHandlers();function setImgAnimalsClickHandlers(){let imgEnvoltura=document.getElementById('imgEnvoltura');let imgTronco=document.getElementById('imgTronco');let imgDefensa=document.getElementById('imgDefensa');let imgPoder=document.getElementById('imgPoder');imgEnvoltura.addEventListener('click',imgAnimalClickHandler);imgTronco.addEventListener('click',imgAnimalClickHandler);imgDefensa.addEventListener('click',imgAnimalClickHandler);imgPoder.addEventListener('click',imgAnimalClickHandler)}function imgAnimalClickHandler(e){let imgId=e.target.id;pId=imgId.slice(3);pId='p'+pId;let para=removeDragonAccent(document.getElementById(pId).textContent);sessionStorage.setItem('pressedAnimal',para);window.location="links/animales/animales.html"}function populateAll(animales,alsoFullDate){if(alsoFullDate){populateFullDate(animales)}setVisiblePilaresTitles();populateImgs(animales);populateParas(animales);saveState();function populateFullDate(animales){despListDia.value=animales["diaNac"];despListMes.value=animales["mesNac"];despListAno.value=animales["anoNac"];despListHour.value=animales["horaNac"];despListMinutes.value=animales["minutosNac"]}function setVisiblePilaresTitles(){let aPilares=document.querySelectorAll('.aPilares');for(let i=0;i<aPilares.length;i++){aPilares[i].style.visibility='visible'}}function populateImgs(animales){let imgEnvoltura=document.getElementById('imgEnvoltura');let imgTronco=document.getElementById('imgTronco');let imgDefensa=document.getElementById('imgDefensa');let imgPoder=document.getElementById('imgPoder');imgEnvoltura.setAttribute('src',imgPath+animales["envoltura"]+".jpg");imgTronco.setAttribute('src',imgPath+animales["tronco"]+".jpg");imgDefensa.setAttribute('src',imgPath+animales["defensa"]+".jpg");imgPoder.setAttribute('src',imgPath+animales["poder"]+".jpg");imgEnvoltura.style.visibility='visible';imgTronco.style.visibility='visible';imgDefensa.style.visibility='visible';imgPoder.style.visibility='visible'}function populateParas(animales){let pEnvoltura=document.getElementById('pEnvoltura');let pTronco=document.getElementById('pTronco');let pDefensa=document.getElementById('pDefensa');let pPoder=document.getElementById('pPoder');pEnvoltura.textContent=setDragonAccent(animales["envoltura"]);pTronco.textContent=setDragonAccent(animales["tronco"]);pDefensa.textContent=setDragonAccent(animales["defensa"]);pPoder.textContent=setDragonAccent(animales["poder"])}}function setDragonAccent(animalStr){if(animalStr==='Dragon'){return'Drag칩n'}else{return animalStr}}function removeDragonAccent(animalStr){if(animalStr==='Drag칩n'){return'Dragon'}else{return animalStr}}function saveState(){sessionStorage.setItem('diaNac',despListDia.value);sessionStorage.setItem('mesNac',despListMes.value);sessionStorage.setItem('anoNac',despListAno.value);sessionStorage.setItem('horaNac',despListHour.value);sessionStorage.setItem('minutosNac',despListMinutes.value);let pEnvoltura=document.getElementById('pEnvoltura');let pTronco=document.getElementById('pTronco');let pDefensa=document.getElementById('pDefensa');let pPoder=document.getElementById('pPoder');sessionStorage.setItem('envoltura',removeDragonAccent(pEnvoltura.textContent));sessionStorage.setItem('tronco',removeDragonAccent(pTronco.textContent));sessionStorage.setItem('defensa',removeDragonAccent(pDefensa.textContent));sessionStorage.setItem('poder',removeDragonAccent(pPoder.textContent))}function loadState(){let clickTheButton=true;let animales=new Array(7);if(sessionStorage.getItem('diaNac')){animales["diaNac"]=sessionStorage.getItem('diaNac')}else{clickTheButton=false}if(sessionStorage.getItem('mesNac')){animales["mesNac"]=sessionStorage.getItem('mesNac')}else{clickTheButton=false}if(sessionStorage.getItem('anoNac')){animales["anoNac"]=sessionStorage.getItem('anoNac')}else{clickTheButton=false}if(sessionStorage.getItem('horaNac')){animales["horaNac"]=sessionStorage.getItem('horaNac')}else{clickTheButton=false}if(sessionStorage.getItem('minutosNac')){animales["minutosNac"]=sessionStorage.getItem('minutosNac')}else{clickTheButton=false}if(sessionStorage.getItem('envoltura')){animales["envoltura"]=sessionStorage.getItem('envoltura')}else{clickTheButton=false}if(sessionStorage.getItem('tronco')){animales["tronco"]=sessionStorage.getItem('tronco')}else{clickTheButton=false}if(sessionStorage.getItem('defensa')){animales["defensa"]=sessionStorage.getItem('defensa')}else{clickTheButton=false}if(sessionStorage.getItem('poder')){animales["poder"]=sessionStorage.getItem('poder')}else{clickTheButton=false}if(clickTheButton){populateAll(animales,true)}}loadState();function populateDespLists(){for(let i=1;i<=31;i++){let newItem=document.createElement('option');newItem.textContent=i.toString();despListDia.appendChild(newItem)}for(let i=1;i<=12;i++){let newItem=document.createElement('option');newItem.textContent=convertMonth(i);despListMes.appendChild(newItem)}let maxYear;if(actualYear>2043){maxYear=2043}else{maxYear=actualYear}for(let i=1901;i<=maxYear;i++){let newItem=document.createElement('option');newItem.textContent=i.toString();despListAno.appendChild(newItem)}for(let i=0;i<24;i++){let newItem=document.createElement('option');newItem.textContent=i.toString();despListHour.appendChild(newItem)}for(let i=0;i<60;i++){let newItem=document.createElement('option');newItem.textContent=i.toString();despListMinutes.appendChild(newItem)}}function convertMonth(month){let salida;switch(month){case 1:salida='Enero';break;case 2:salida='Febrero';break;case 3:salida='Marzo';break;case 4:salida='Abril';break;case 5:salida='Mayo';break;case 6:salida='Junio';break;case 7:salida='Julio';break;case 8:salida='Agosto';break;case 9:salida='Septiembre';break;case 10:salida='Octubre';break;case 11:salida='Noviembre';break;case 12:salida='Diciembre';break;default:salida='Enero';break}return salida}function btnCalcularHandler(){let pDateInvalid=document.getElementById('pDateInvalid');let validFullData=true;let validHour=true;let validMinutes=true;pDateInvalid.style.visibility='hidden';yearOutGolangApi=false;if(!isValidDate(despListDia.value,convertStrMonthToInt(String(despListMes.value)),despListAno.value)){validFullData=false;if(yearOutGolangApi){pDateInvalid.textContent='El a침o debe estar dentro del rango: 1901 - 2043.'}else{pDateInvalid.textContent='La fecha ingresada no es v치lida.'}pDateInvalid.style.visibility='visible'}if(!isValidHour(String(despListHour.value))){validFullData=false;validHour=false}if(!isValidMinutes(String(despListMinutes.value))){validFullData=false;validMinutes=false}if(validFullData){let requestURL=requestConstURL+getFullDate();let request=new XMLHttpRequest();request.open('GET',requestURL);request.responseType='json';btnCalcular.style.cursor='wait';document.body.style.cursor='wait';request.send();request.onload=function(){btnCalcular.style.cursor='default';document.body.style.cursor='default';populateAll(request.response,false)}}function convertStrMonthToInt(strMonth){let salida;switch(strMonth){case'Enero':salida=1;break;case'Febrero':salida=2;break;case'Marzo':salida=3;break;case'Abril':salida=4;break;case'Mayo':salida=5;break;case'Junio':salida=6;break;case'Julio':salida=7;break;case'Agosto':salida=8;break;case'Septiembre':salida=9;break;case'Octubre':salida=10;break;case'Noviembre':salida=11;break;case'Diciembre':salida=12;break;default:salida=1;break}return salida}function isValidDate(day,month,year){yearOutGolangApi=false;if(isNaN(day)||isNaN(month)||isNaN(year)){return false}if(day<1||year<1){return false}if(month>12||month<1){return false}if((month==1||month==3||month==5||month==7||month==8||month==10||month==12)&&day>31){return false}if((month==4||month==6||month==9||month==11)&&day>30){return false}if(month==2){if(((year%4)==0&&(year%100)!=0)||((year%400)==0&&(year%100)==0)){if(day>29)return false;}else{if(day>28)return false;}}if(year<1901||year>2043){yearOutGolangApi=true;return false}return true}function isValidHour(hour){let salida=false;if(hour.length<=2){if(isNaturalNumber(hour)){let hourInt=parseInt(hour,10);salida=((hourInt>=0)&&(hourInt<=23))}}return salida}function isValidMinutes(minutes){let salida=false;if(minutes.length<=2){if(isNaturalNumber(minutes)){let minutesInt=parseInt(minutes,10);salida=((minutesInt>=0)&&(minutesInt<=59))}}return salida}function isDigit(c){let salida;switch(c){case'0':case'1':case'2':case'3':case'4':case'5':case'6':case'7':case'8':case'9':salida=true;break;default:salida=false;break}return salida}function isNaturalNumber(s){let ok=true;let i=0;while(ok&&(i<s.length)){ok=isDigit(s[i]);i++}return ok}function getFullDate(){strDay=despListDia.value.toString();strMonth=String(despListMes.value);strYear=despListAno.value.toString();if(despListDia.value<=9){strDay='0'+strDay}intMonth=convertStrMonthToInt(strMonth);strMonth=intMonth.toString();if(intMonth<=9){strMonth='0'+strMonth}fechaNac=strDay+'-'+strMonth+'-'+strYear;let hourInt=parseInt(String(despListHour.value),10);let minutesInt=parseInt(String(despListMinutes.value),10);let horaNac;let minutosNac;if(hourInt<=9){horaNac='0'+hourInt.toString()}else{horaNac=despListHour.value}if(minutesInt<=9){minutosNac='0'+minutesInt.toString()}else{minutosNac=despListMinutes.value}return(fechaNac+' '+horaNac+':'+minutosNac)}}function btnRHandler(){sessionStorage.clear();location.reload()}